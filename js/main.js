'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}(function(){'use strict';function a(a){if(i=a,j.setNumber(i),i.length===m.limit){var b=m.candies.filter(function(a){return a.number===i})[0];b?j.set(b):j.setNull()}}function b(){n=!1,a(''),j.clear()}function c(a){return(m=l[a],!!m)&&(m.index=a,j.setPosition(m.position),b(),m)}function d(){k=[],c(0)}function e(a,b,c){b.collection(a).get().then(function(a){a.forEach(function(a){var b=a.data();b.ref=a.ref,b.id=a.id,c(b)})})}function f(a){console.log('Enviando votos');var b=a.map(function(a){var b=a.position,c=a.candies,d=a.vote,e=d?c.filter(function(a){return a.number===d})[0]||g.nullCandy():g.blankCandy(),f=e.name,h=e.party;return{position:b,vote:d,name:f,party:h}});console.table(b)}var g=function(){function a(b,c,d,e){_classCallCheck(this,a),this.img=e,this.name=c,this.party=d,this.number=b}return _createClass(a,[{key:'plainObject',value:function plainObject(){return{img:this.img,name:this.name,party:this.party,number:this.number}}}],[{key:'nullCandy',value:function nullCandy(){return new a('','N\xDAMERO ERRADO','VOTO NULO')}},{key:'blankCandy',value:function blankCandy(){return new a('','','VOTO EM BRANCO')}}]),a}(),h=function(){function a(b){_classCallCheck(this,a);var c=this.root=document.querySelector(b);c&&(this.position=c.querySelector('.display-position'),this.number=c.querySelector('.display-number'),this.img=c.querySelector('.display-img'),this.blank_img=this.img.src,this.name=c.querySelector('.display-name'),this.party=c.querySelector('.display-party'),this.body=c.querySelector('.display-body'),this.footer=c.querySelector('.display-footer'))}return _createClass(a,[{key:'setNumber',value:function(a){this.number.textContent=a.trim()}},{key:'setPosition',value:function setPosition(a){this.position.textContent=a.trim()}},{key:'set',value:function set(a){this.img.src=a.img||this.blank_img,this.name.textContent=a.name,this.party.textContent=a.party,this.body.removeAttribute('hidden'),this.footer.removeAttribute('hidden')}},{key:'setNull',value:function setNull(){this.set(g.nullCandy()),this.root.classList.add('is-null')}},{key:'setBlank',value:function setBlank(){this.set(g.blankCandy()),this.root.classList.add('is-blank')}},{key:'clear',value:function(){this.img.src=this.blank_img,this.name.textContent='',this.party.textContent='',this.body.setAttribute('hidden',!0),this.footer.setAttribute('hidden',!0),this.root.classList.remove('is-null'),this.root.classList.remove('is-blank')}}]),a}(),j=new h('.display'),i='',k=[],l=[],m={},n=!1,o={insert:function insert(b){return!n&&!(isNaN(b)||0>b)&&!(i.length>=m.limit)&&void a(i+b)},confirm:function confirm(){if((i.length===m.limit||n)&&(m.vote=i||null,k.push(m),!c(m.index+1))){var a=k;return c(0),d(),a}},blank:function blank(){n=!0,i||j.setBlank()},start:function start(a){l=a,c(0)},clear:b,votes:k,display:j},p=window.firebase.auth(),q=window.firebase.firestore(),r=[];e('ballots',q,function(a){r.push(a),a.steps=[],e('steps',a.ref,function(b){a.steps.push(b),b.candies=[],e('candies',b.ref,function(a){b.candies.push(a),new Image().src=a.img}),o.start(r[0].steps)})});var s={digitar:function digitar(){o.insert(this.textContent.trim())},branco:function branco(){o.blank()},corrigir:function corrigir(){o.clear()},confirmar:function confirmar(){var a=o.confirm();a&&f(a)}};Array.prototype.forEach.call(document.querySelectorAll('.panel button'),function(a){return a.addEventListener('click',function(){s[this.dataset.click].call(this)})})})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic2V0TnVtYmVyIiwibGVuZ3RoIiwibGltaXQiLCJjYW5kaWVzIiwiZmlsdGVyIiwibnVtYmVyIiwic2V0Iiwic2V0TnVsbCIsImNsZWFyIiwiaW5kZXgiLCJzZXRQb3NpdGlvbiIsInBvc2l0aW9uIiwiY29sbGVjdGlvbiIsImdldCIsInRoZW4iLCJmb3JFYWNoIiwiZGF0YSIsInJlZiIsImlkIiwiY29uc29sZSIsImxvZyIsIm1hcCIsInZvdGUiLCJudWxsQ2FuZHkiLCJibGFua0NhbmR5IiwibmFtZSIsInBhcnR5IiwidGFibGUiLCJpbWciLCJyb290IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYmxhbmtfaW1nIiwic3JjIiwiYm9keSIsImZvb3RlciIsInRleHRDb250ZW50IiwidHJpbSIsInJlbW92ZUF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsInJlbW92ZSIsImluc2VydCIsImlzTmFOIiwiY29uZmlybSIsInB1c2giLCJibGFuayIsInNldEJsYW5rIiwic3RhcnQiLCJ2b3RlcyIsImRpc3BsYXkiLCJ3aW5kb3ciLCJmaXJlYmFzZSIsImF1dGgiLCJmaXJlc3RvcmUiLCJzdGVwcyIsIkltYWdlIiwiZGlnaXRhciIsImJyYW5jbyIsImNvcnJpZ2lyIiwiY29uZmlybWFyIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJjYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkYXRhc2V0IiwiY2xpY2siXSwibWFwcGluZ3MiOiJ5WEFBQyxXQUFZLENBQ2IsYUFzSEEsYUFBd0IsQ0FHcEIsR0FGQSxHQUVBLENBREEsRUFBUUEsU0FBUixHQUNBLENBQUksRUFBT0MsTUFBUCxHQUFrQixFQUFLQyxLQUEzQixDQUFrQyxDQUM5QixHQUFNLEdBQVEsRUFBS0MsT0FBTCxDQUFhQyxNQUFiLENBQW9CLGtCQUFLLEdBQUVDLE1BQUYsSUFBTCxDQUFwQixFQUE4QyxDQUE5QyxDQUFkLENBRDhCLEVBRW5CLEVBQVFDLEdBQVIsR0FGbUIsQ0FHekIsRUFBUUMsT0FBUixFQUNSLENBQ0osQ0FFRCxZQUFpQixDQUNiLElBRGEsQ0FFYixFQUFVLEVBQVYsQ0FGYSxDQUdiLEVBQVFDLEtBQVIsRUFDSCxDQUVELGFBQW9CLFFBQ2hCLEVBQU8sSUFEUyxFQUVaLEVBRlksSUFHaEIsRUFBS0MsS0FBTCxFQUhnQixDQUloQixFQUFRQyxXQUFSLENBQW9CLEVBQUtDLFFBQXpCLENBSmdCLENBS2hCLEdBTGdCLEdBT25CLENBRUQsWUFBbUIsQ0FDZixFQUFRLEVBRE8sQ0FFZixFQUFRLENBQVIsQ0FDSCxDQU9ELGlCQUErQyxDQUMzQyxFQUFJQyxVQUFKLElBQXlCQyxHQUF6QixHQUErQkMsSUFBL0IsQ0FBb0MsV0FBUSxDQUN4QyxFQUFLQyxPQUFMLENBQWEsV0FBUSxDQUNqQixHQUFNLEdBQU8sRUFBS0MsSUFBTCxFQUFiLENBQ0EsRUFBS0MsR0FBTCxDQUFXLEVBQUtBLEdBRkMsQ0FHakIsRUFBS0MsRUFBTCxDQUFVLEVBQUtBLEVBSEUsQ0FJakIsSUFDSCxDQUxELENBTUgsQ0FQRCxDQVFILENBMERELGFBQTJCLENBQ3ZCQyxRQUFRQyxHQUFSLENBQVksZ0JBQVosQ0FEdUIsQ0FHdkIsR0FBTSxHQUFVLEVBQU1DLEdBQU4sQ0FBVSxXQUFLLFNBRXZCVixRQUZ1QixLQUd2QlIsT0FIdUIsS0FJdkJtQixJQUp1QixDQU1yQixFQUFRLEVBRVYsRUFBUWxCLE1BQVIsQ0FBZSxrQkFBSyxHQUFFQyxNQUFGLElBQUwsQ0FBZixFQUF1QyxDQUF2QyxHQUNBLEVBQU1rQixTQUFOLEVBSFUsQ0FDVixFQUFNQyxVQUFOLEVBUHVCLEtBV3ZCQyxJQVh1QixLQVl2QkMsS0FadUIsQ0FjM0IsTUFBTyxDQUNIZixVQURHLENBRUhXLE1BRkcsQ0FHSEcsTUFIRyxDQUlIQyxPQUpHLENBTVYsQ0FwQmUsQ0FBaEIsQ0FzQkFQLFFBQVFRLEtBQVIsR0FDSCxDQXZQWSxpQkFJVCxtQkFBc0MseUJBQ2xDLEtBQUtDLEdBQUwsRUFEa0MsQ0FFbEMsS0FBS0gsSUFBTCxFQUZrQyxDQUdsQyxLQUFLQyxLQUFMLEVBSGtDLENBSWxDLEtBQUtyQixNQUFMLEVBQ0gsQ0FUUSxzRUFVSyxDQUNWLE1BQU8sQ0FDSHVCLElBQUssS0FBS0EsR0FEUCxDQUVISCxLQUFNLEtBQUtBLElBRlIsQ0FHSEMsTUFBTyxLQUFLQSxLQUhULENBSUhyQixPQUFRLEtBQUtBLE1BSlYsQ0FNVixDQWpCUSwrQ0FrQlUsQ0FDZixNQUFPLE9BQVUsRUFBVixDQUFjLGtCQUFkLENBQStCLFdBQS9CLENBQ1YsQ0FwQlEsK0NBcUJXLENBQ2hCLE1BQU8sT0FBVSxFQUFWLENBQWMsRUFBZCxDQUFrQixnQkFBbEIsQ0FDVixDQXZCUSxzQkE0QlQsYUFBa0IseUJBQ2QsR0FBTSxHQUFPLEtBQUt3QixJQUFMLENBQVlDLFNBQVNDLGFBQVQsR0FBekIsQ0FEYyxJQUdkLEtBQUtwQixRQUFMLENBQWdCLEVBQUtvQixhQUFMLENBQW1CLG1CQUFuQixDQUhGLENBSWQsS0FBSzFCLE1BQUwsQ0FBYyxFQUFLMEIsYUFBTCxDQUFtQixpQkFBbkIsQ0FKQSxDQUtkLEtBQUtILEdBQUwsQ0FBVyxFQUFLRyxhQUFMLENBQW1CLGNBQW5CLENBTEcsQ0FNZCxLQUFLQyxTQUFMLENBQWlCLEtBQUtKLEdBQUwsQ0FBU0ssR0FOWixDQU9kLEtBQUtSLElBQUwsQ0FBWSxFQUFLTSxhQUFMLENBQW1CLGVBQW5CLENBUEUsQ0FRZCxLQUFLTCxLQUFMLENBQWEsRUFBS0ssYUFBTCxDQUFtQixnQkFBbkIsQ0FSQyxDQVNkLEtBQUtHLElBQUwsQ0FBWSxFQUFLSCxhQUFMLENBQW1CLGVBQW5CLENBVEUsQ0FVZCxLQUFLSSxNQUFMLENBQWMsRUFBS0osYUFBTCxDQUFtQixpQkFBbkIsQ0FWQSxDQVdqQixDQXZDUSx5REF5Q0ksQ0FDVCxLQUFLMUIsTUFBTCxDQUFZK0IsV0FBWixDQUEwQixFQUFFQyxJQUFGLEVBQzdCLENBM0NRLGtEQTZDTSxDQUNYLEtBQUsxQixRQUFMLENBQWN5QixXQUFkLENBQTRCLEVBQUVDLElBQUYsRUFDL0IsQ0EvQ1Esa0NBaURFLENBQ1AsS0FBS1QsR0FBTCxDQUFTSyxHQUFULENBQWUsRUFBTUwsR0FBTixFQUFhLEtBQUtJLFNBRDFCLENBRVAsS0FBS1AsSUFBTCxDQUFVVyxXQUFWLENBQXdCLEVBQU1YLElBRnZCLENBR1AsS0FBS0MsS0FBTCxDQUFXVSxXQUFYLENBQXlCLEVBQU1WLEtBSHhCLENBSVAsS0FBS1EsSUFBTCxDQUFVSSxlQUFWLENBQTBCLFFBQTFCLENBSk8sQ0FLUCxLQUFLSCxNQUFMLENBQVlHLGVBQVosQ0FBNEIsUUFBNUIsQ0FDSCxDQXZEUSx5Q0F5REMsQ0FDTixLQUFLaEMsR0FBTCxDQUFTLEVBQU1pQixTQUFOLEVBQVQsQ0FETSxDQUVOLEtBQUtNLElBQUwsQ0FBVVUsU0FBVixDQUFvQkMsR0FBcEIsQ0FBd0IsU0FBeEIsQ0FDSCxDQTVEUSwyQ0E4REUsQ0FDUCxLQUFLbEMsR0FBTCxDQUFTLEVBQU1rQixVQUFOLEVBQVQsQ0FETyxDQUVQLEtBQUtLLElBQUwsQ0FBVVUsU0FBVixDQUFvQkMsR0FBcEIsQ0FBd0IsVUFBeEIsQ0FDSCxDQWpFUSwrQkFtRUQsQ0FDSixLQUFLWixHQUFMLENBQVNLLEdBQVQsQ0FBZSxLQUFLRCxTQURoQixDQUVKLEtBQUtQLElBQUwsQ0FBVVcsV0FBVixDQUF3QixFQUZwQixDQUdKLEtBQUtWLEtBQUwsQ0FBV1UsV0FBWCxDQUF5QixFQUhyQixDQUlKLEtBQUtGLElBQUwsQ0FBVU8sWUFBVixDQUF1QixRQUF2QixJQUpJLENBS0osS0FBS04sTUFBTCxDQUFZTSxZQUFaLENBQXlCLFFBQXpCLElBTEksQ0FNSixLQUFLWixJQUFMLENBQVVVLFNBQVYsQ0FBb0JHLE1BQXBCLENBQTJCLFNBQTNCLENBTkksQ0FPSixLQUFLYixJQUFMLENBQVVVLFNBQVYsQ0FBb0JHLE1BQXBCLENBQTJCLFVBQTNCLENBQ0gsQ0EzRVEsU0ErRVAsRUFBVSxNQUFZLFVBQVosQ0EvRUgsQ0FpRlQsRUFBUyxFQWpGQSxDQWtGVCxFQUFRLEVBbEZDLENBbUZULEVBQVEsRUFuRkMsQ0FvRlQsRUFBTyxFQXBGRSxDQXFGVCxJQXJGUyxDQXVGUCxFQUFTLENBQ1hDLE9BQVEsa0JBQU8sYUFFUEMsVUFBb0IsQ0FBTixFQUZQLEtBR1AsRUFBTzNDLE1BQVAsRUFBaUIsRUFBS0MsS0FIZixPQUlYLEdBQVUsR0FBVixDQUNILENBTlUsQ0FPWDJDLFFBQVMsa0JBQU0sQ0FDWCxJQUFJLEVBQU81QyxNQUFQLEdBQWtCLEVBQUtDLEtBQXZCLEdBQUosSUFDSSxFQUFLb0IsSUFBTCxDQUFZLEdBQVUsSUFEMUIsQ0FFSSxFQUFNd0IsSUFBTixHQUZKLENBR1EsQ0FBQyxFQUFRLEVBQUtyQyxLQUFMLENBQWEsQ0FBckIsQ0FIVCxFQUdrQyxDQUMxQixHQUFNLElBQU4sQ0FHQSxNQUZBLEdBQVEsQ0FBUixDQUVBLENBREEsR0FDQSxFQUNILENBRVIsQ0FsQlUsQ0FtQlhzQyxNQUFPLGdCQUFNLENBQ1QsSUFEUyxJQUVJLEVBQVFDLFFBQVIsRUFDaEIsQ0F0QlUsQ0F1QlhDLE1BQU8saUJBQU8sQ0FDVixHQURVLENBRVYsRUFBUSxDQUFSLENBQ0gsQ0ExQlUsQ0EyQlh6QyxPQTNCVyxDQTRCWDBDLE9BNUJXLENBNkJYQyxTQTdCVyxDQXZGRixDQXFKUCxFQUFZQyxPQUFPQyxRQUFQLENBQWdCQyxJQUFoQixFQXJKTCxDQXdKUCxFQUFZRixPQUFPQyxRQUFQLENBQWdCRSxTQUFoQixFQXhKTCxDQXFLUCxFQUFrQixFQXJLWCxDQXNLYixFQUFhLFNBQWIsR0FBbUMsV0FBWSxDQUMzQyxFQUFnQlQsSUFBaEIsR0FEMkMsQ0FHM0MsRUFBU1UsS0FBVCxDQUFpQixFQUgwQixDQUkzQyxFQUFhLE9BQWIsQ0FBc0IsRUFBU3ZDLEdBQS9CLENBQW9DLFdBQVksQ0FDNUMsRUFBU3VDLEtBQVQsQ0FBZVYsSUFBZixHQUQ0QyxDQUk1QyxFQUFTM0MsT0FBVCxDQUFtQixFQUp5QixDQUs1QyxFQUFhLFNBQWIsQ0FBd0IsRUFBU2MsR0FBakMsQ0FBc0MsV0FBYSxDQUMvQyxFQUFTZCxPQUFULENBQWlCMkMsSUFBakIsR0FEK0MsQ0FJOUMsR0FBSVcsTUFBSixFQUFELENBQWN4QixHQUFkLENBQW9CLEVBQVVMLEdBRWpDLENBTkQsQ0FMNEMsQ0FhNUMsRUFBT3FCLEtBQVAsQ0FBYSxFQUFnQixDQUFoQixFQUFtQk8sS0FBaEMsQ0FDSCxDQWRELENBaUJILENBckJELENBdEthLENBc01iLEdBQU0sR0FBYyxDQUNoQkUsUUFBUyxrQkFBWSxDQUNqQixFQUFPZixNQUFQLENBQWMsS0FBS1AsV0FBTCxDQUFpQkMsSUFBakIsRUFBZCxDQUNILENBSGUsQ0FJaEJzQixPQUFRLGlCQUFZLENBQ2hCLEVBQU9aLEtBQVAsRUFDSCxDQU5lLENBT2hCYSxTQUFVLG1CQUFZLENBQ2xCLEVBQU9wRCxLQUFQLEVBQ0gsQ0FUZSxDQVVoQnFELFVBQVcsb0JBQVksQ0FDbkIsR0FBTSxHQUFRLEVBQU9oQixPQUFQLEVBQWQsQ0FDQSxHQUFTLElBQ1osQ0FiZSxDQUFwQixDQWdCQWlCLE1BQU1DLFNBQU4sQ0FBZ0JoRCxPQUFoQixDQUF3QmlELElBQXhCLENBQ0lsQyxTQUFTbUMsZ0JBQVQsQ0FBMEIsZUFBMUIsQ0FESixDQUVJLGtCQUFPLEdBQUlDLGdCQUFKLENBQXFCLE9BQXJCLENBQThCLFVBQVksQ0FDN0MsRUFBWSxLQUFLQyxPQUFMLENBQWFDLEtBQXpCLEVBQWdDSixJQUFoQyxDQUFxQyxJQUFyQyxDQUNILENBRk0sQ0FBUCxDQUZKLENBbUNDLENBelBBLEciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4ndXNlIHN0cmljdCc7XG5cbmNsYXNzIENhbmR5IHtcclxuICAgIGNvbnN0cnVjdG9yKG51bWJlciwgbmFtZSwgcGFydHksIGltZykge1xyXG4gICAgICAgIHRoaXMuaW1nID0gaW1nO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5wYXJ0eSA9IHBhcnR5O1xyXG4gICAgICAgIHRoaXMubnVtYmVyID0gbnVtYmVyO1xyXG4gICAgfVxyXG4gICAgcGxhaW5PYmplY3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW1nOiB0aGlzLmltZyxcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICAgICAgICBwYXJ0eTogdGhpcy5wYXJ0eSxcclxuICAgICAgICAgICAgbnVtYmVyOiB0aGlzLm51bWJlclxyXG4gICAgICAgIH1cclxuICAgIH0gXHJcbiAgICBzdGF0aWMgbnVsbENhbmR5KCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2FuZHkoJycsICdOw5pNRVJPIEVSUkFETycsICdWT1RPIE5VTE8nKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBibGFua0NhbmR5KCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2FuZHkoJycsICcnLCAnVk9UTyBFTSBCUkFOQ08nKTtcclxuICAgIH1cclxufVxuXG5jbGFzcyBEaXNwbGF5IHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih3aGF0KSB7XHJcbiAgICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iod2hhdCk7XHJcbiAgICAgICAgaWYgKCFyb290KSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHJvb3QucXVlcnlTZWxlY3RvcignLmRpc3BsYXktcG9zaXRpb24nKTtcclxuICAgICAgICB0aGlzLm51bWJlciA9IHJvb3QucXVlcnlTZWxlY3RvcignLmRpc3BsYXktbnVtYmVyJyk7XHJcbiAgICAgICAgdGhpcy5pbWcgPSByb290LnF1ZXJ5U2VsZWN0b3IoJy5kaXNwbGF5LWltZycpO1xyXG4gICAgICAgIHRoaXMuYmxhbmtfaW1nID0gdGhpcy5pbWcuc3JjO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IHJvb3QucXVlcnlTZWxlY3RvcignLmRpc3BsYXktbmFtZScpO1xyXG4gICAgICAgIHRoaXMucGFydHkgPSByb290LnF1ZXJ5U2VsZWN0b3IoJy5kaXNwbGF5LXBhcnR5Jyk7XHJcbiAgICAgICAgdGhpcy5ib2R5ID0gcm9vdC5xdWVyeVNlbGVjdG9yKCcuZGlzcGxheS1ib2R5Jyk7XHJcbiAgICAgICAgdGhpcy5mb290ZXIgPSByb290LnF1ZXJ5U2VsZWN0b3IoJy5kaXNwbGF5LWZvb3RlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE51bWJlcihuKSB7XHJcbiAgICAgICAgdGhpcy5udW1iZXIudGV4dENvbnRlbnQgPSBuLnRyaW0oKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQb3NpdGlvbihwKSB7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbi50ZXh0Q29udGVudCA9IHAudHJpbSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldChjYW5keSkge1xyXG4gICAgICAgIHRoaXMuaW1nLnNyYyA9IGNhbmR5LmltZyB8fCB0aGlzLmJsYW5rX2ltZztcclxuICAgICAgICB0aGlzLm5hbWUudGV4dENvbnRlbnQgPSBjYW5keS5uYW1lO1xyXG4gICAgICAgIHRoaXMucGFydHkudGV4dENvbnRlbnQgPSBjYW5keS5wYXJ0eTtcclxuICAgICAgICB0aGlzLmJvZHkucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcclxuICAgICAgICB0aGlzLmZvb3Rlci5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE51bGwoKSB7XHJcbiAgICAgICAgdGhpcy5zZXQoQ2FuZHkubnVsbENhbmR5KCkpO1xyXG4gICAgICAgIHRoaXMucm9vdC5jbGFzc0xpc3QuYWRkKCdpcy1udWxsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QmxhbmsoKSB7XHJcbiAgICAgICAgdGhpcy5zZXQoQ2FuZHkuYmxhbmtDYW5keSgpKTtcclxuICAgICAgICB0aGlzLnJvb3QuY2xhc3NMaXN0LmFkZCgnaXMtYmxhbmsnKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLmltZy5zcmMgPSB0aGlzLmJsYW5rX2ltZztcclxuICAgICAgICB0aGlzLm5hbWUudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgICB0aGlzLnBhcnR5LnRleHRDb250ZW50ID0gJyc7XHJcbiAgICAgICAgdGhpcy5ib2R5LnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5mb290ZXIuc2V0QXR0cmlidXRlKCdoaWRkZW4nLCB0cnVlKTtcclxuICAgICAgICB0aGlzLnJvb3QuY2xhc3NMaXN0LnJlbW92ZSgnaXMtbnVsbCcpO1xyXG4gICAgICAgIHRoaXMucm9vdC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1ibGFuaycpO1xyXG4gICAgfVxyXG5cclxufVxuXG5jb25zdCBkaXNwbGF5ID0gbmV3IERpc3BsYXkoJy5kaXNwbGF5Jyk7XHJcblxyXG5sZXQgbnVtYmVyID0gJyc7XHJcbmxldCB2b3RlcyA9IFtdO1xyXG5sZXQgc3RlcHMgPSBbXTtcclxubGV0IHN0ZXAgPSB7fTtcclxubGV0IGlzQmxhbmsgPSBmYWxzZTtcclxuXHJcbmNvbnN0IGJhbGxvdCA9IHtcclxuICAgIGluc2VydDogbnVtID0+IHtcclxuICAgICAgICBpZiAoaXNCbGFuaykgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGlmIChpc05hTihudW0pIHx8IG51bSA8IDApIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZiAobnVtYmVyLmxlbmd0aCA+PSBzdGVwLmxpbWl0KSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgc2V0TnVtYmVyKG51bWJlciArIG51bSk7XHJcbiAgICB9LFxyXG4gICAgY29uZmlybTogKCkgPT4ge1xyXG4gICAgICAgIGlmIChudW1iZXIubGVuZ3RoID09PSBzdGVwLmxpbWl0IHx8IGlzQmxhbmspIHtcclxuICAgICAgICAgICAgc3RlcC52b3RlID0gbnVtYmVyIHx8IG51bGw7XHJcbiAgICAgICAgICAgIHZvdGVzLnB1c2goc3RlcCk7XHJcbiAgICAgICAgICAgIGlmICghc2V0U3RlcChzdGVwLmluZGV4ICsgMSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB2b3RlcztcclxuICAgICAgICAgICAgICAgIHNldFN0ZXAoMCk7XHJcbiAgICAgICAgICAgICAgICByZXN0YXJ0KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBibGFuazogKCkgPT4ge1xyXG4gICAgICAgIGlzQmxhbmsgPSB0cnVlO1xyXG4gICAgICAgIGlmICghbnVtYmVyKSBkaXNwbGF5LnNldEJsYW5rKCk7XHJcbiAgICB9LFxyXG4gICAgc3RhcnQ6IChzKSA9PiB7XHJcbiAgICAgICAgc3RlcHMgPSBzO1xyXG4gICAgICAgIHNldFN0ZXAoMCk7XHJcbiAgICB9LFxyXG4gICAgY2xlYXIsXHJcbiAgICB2b3RlcyxcclxuICAgIGRpc3BsYXlcclxufTtcclxuXHJcbmZ1bmN0aW9uIHNldE51bWJlcihudW0pIHtcclxuICAgIG51bWJlciA9IG51bTtcclxuICAgIGRpc3BsYXkuc2V0TnVtYmVyKG51bWJlcik7XHJcbiAgICBpZiAobnVtYmVyLmxlbmd0aCA9PT0gc3RlcC5saW1pdCkge1xyXG4gICAgICAgIGNvbnN0IGNhbmR5ID0gc3RlcC5jYW5kaWVzLmZpbHRlcihjID0+IGMubnVtYmVyID09PSBudW1iZXIpWzBdO1xyXG4gICAgICAgIGlmIChjYW5keSkgZGlzcGxheS5zZXQoY2FuZHkpO1xyXG4gICAgICAgIGVsc2UgZGlzcGxheS5zZXROdWxsKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFyKCkge1xyXG4gICAgaXNCbGFuayA9IGZhbHNlO1xyXG4gICAgc2V0TnVtYmVyKCcnKTtcclxuICAgIGRpc3BsYXkuY2xlYXIoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0U3RlcChpKSB7XHJcbiAgICBzdGVwID0gc3RlcHNbaV07XHJcbiAgICBpZiAoIXN0ZXApIHJldHVybiBmYWxzZTtcclxuICAgIHN0ZXAuaW5kZXggPSBpO1xyXG4gICAgZGlzcGxheS5zZXRQb3NpdGlvbihzdGVwLnBvc2l0aW9uKTtcclxuICAgIGNsZWFyKCk7XHJcbiAgICByZXR1cm4gc3RlcDtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVzdGFydCgpIHtcclxuICAgIHZvdGVzID0gW107XHJcbiAgICBzZXRTdGVwKDApO1xyXG59XG5cbmNvbnN0IEZJUkVfQVVUSCA9IHdpbmRvdy5maXJlYmFzZS5hdXRoKCk7XHJcblxyXG4vLyBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9maXJlc3RvcmUvcXVpY2tzdGFydD9hdXRodXNlcj0wXHJcbmNvbnN0IEZJUkVTVE9SRSA9IHdpbmRvdy5maXJlYmFzZS5maXJlc3RvcmUoKTtcclxuXHJcbmZ1bmN0aW9uIGdldENvbGxldGlvbihjb2xsTmFtZSwgcmVmLCBjYWxsYmFjaykge1xyXG4gICAgcmVmLmNvbGxlY3Rpb24oY29sbE5hbWUpLmdldCgpLnRoZW4oc25hcCA9PiB7XHJcbiAgICAgICAgc25hcC5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gaXRlbS5kYXRhKCk7XHJcbiAgICAgICAgICAgIGRhdGEucmVmID0gaXRlbS5yZWY7XHJcbiAgICAgICAgICAgIGRhdGEuaWQgPSBpdGVtLmlkO1xyXG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jb25zdCBiYWxsb3RfYWxsX2RhdGEgPSBbXTtcclxuZ2V0Q29sbGV0aW9uKCdiYWxsb3RzJywgRklSRVNUT1JFLCBiYWxsRGF0YSA9PiB7XHJcbiAgICBiYWxsb3RfYWxsX2RhdGEucHVzaChiYWxsRGF0YSk7XHJcblxyXG4gICAgYmFsbERhdGEuc3RlcHMgPSBbXTtcclxuICAgIGdldENvbGxldGlvbignc3RlcHMnLCBiYWxsRGF0YS5yZWYsIHN0ZXBEYXRhID0+IHtcclxuICAgICAgICBiYWxsRGF0YS5zdGVwcy5wdXNoKHN0ZXBEYXRhKTtcclxuXHJcbiAgICAgICAgLy8gcGF1c2FyIG8gYXBsaWNhdGl2byBhcXVpXHJcbiAgICAgICAgc3RlcERhdGEuY2FuZGllcyA9IFtdO1xyXG4gICAgICAgIGdldENvbGxldGlvbignY2FuZGllcycsIHN0ZXBEYXRhLnJlZiwgY2FuZHlEYXRhID0+IHtcclxuICAgICAgICAgICAgc3RlcERhdGEuY2FuZGllcy5wdXNoKGNhbmR5RGF0YSk7XHJcblxyXG4gICAgICAgICAgICAvLyBjb250aW51YXIgYSBleGVjdcOnw6NvIGFxdWlcclxuICAgICAgICAgICAgKG5ldyBJbWFnZSgpKS5zcmMgPSBjYW5keURhdGEuaW1nO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgYmFsbG90LnN0YXJ0KGJhbGxvdF9hbGxfZGF0YVswXS5zdGVwcyk7XHJcbiAgICB9KTtcclxuXHJcblxyXG59KTtcclxuXHJcbi8vIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2ZpcmViYXNlXHJcblxyXG4vKipcclxuICogVE9ETzogQ2FycmVnYXIgbGlzdGEgZGUgZWxlacOnw7VlcyB7dMOtdHVsbywgZGVzY3Jpw6fDo28sIHBhc3Nvc1t7cG9zaXRpb24sIGxpbWl0LCBjYW5kaWVzW119XX1cclxuICogVE9ETzogQ2FycmVnYXIgbGlzdGEgZGUgc2FsYXMgW3tub21lLCB0dXJtYSwgcGVyw61vZG99XVxyXG4gKiBUT0RPOiBJbnN0YW5jaWFyIHR1cm5vcyBkYSBlbGVpw6fDo28gW2Fub11cclxuICogVE9ETzogTGlzdGFyIHJlc3VsdGFkb3NcclxuICovXHJcblxyXG5jb25zdCBwYW5lbEFjdGlvbiA9IHtcclxuICAgIGRpZ2l0YXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBiYWxsb3QuaW5zZXJ0KHRoaXMudGV4dENvbnRlbnQudHJpbSgpKTtcclxuICAgIH0sXHJcbiAgICBicmFuY286IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBiYWxsb3QuYmxhbmsoKTtcclxuICAgIH0sXHJcbiAgICBjb3JyaWdpcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGJhbGxvdC5jbGVhcigpO1xyXG4gICAgfSxcclxuICAgIGNvbmZpcm1hcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHZvdGVzID0gYmFsbG90LmNvbmZpcm0oKTtcclxuICAgICAgICB2b3RlcyAmJiBzZW5kQmFsbG90KHZvdGVzKTtcclxuICAgIH1cclxufTtcclxuXHJcbkFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGFuZWwgYnV0dG9uJyksXHJcbiAgICBidG4gPT4gYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHBhbmVsQWN0aW9uW3RoaXMuZGF0YXNldC5jbGlja10uY2FsbCh0aGlzKTtcclxuICAgIH0pXHJcbik7XHJcblxyXG5mdW5jdGlvbiBzZW5kQmFsbG90KHZvdGVzKSB7XHJcbiAgICBjb25zb2xlLmxvZygnRW52aWFuZG8gdm90b3MnKTtcclxuXHJcbiAgICBjb25zdCByZXN1bHRzID0gdm90ZXMubWFwKHYgPT4ge1xyXG4gICAgICAgIGNvbnN0IHtcclxuICAgICAgICAgICAgcG9zaXRpb24sXHJcbiAgICAgICAgICAgIGNhbmRpZXMsXHJcbiAgICAgICAgICAgIHZvdGVcclxuICAgICAgICB9ID0gdjtcclxuICAgICAgICBjb25zdCBjYW5keSA9ICF2b3RlID9cclxuICAgICAgICAgICAgQ2FuZHkuYmxhbmtDYW5keSgpIDpcclxuICAgICAgICAgICAgY2FuZGllcy5maWx0ZXIoYyA9PiBjLm51bWJlciA9PT0gdm90ZSlbMF0gfHxcclxuICAgICAgICAgICAgQ2FuZHkubnVsbENhbmR5KCk7XHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICBwYXJ0eVxyXG4gICAgICAgIH0gPSBjYW5keTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwb3NpdGlvbixcclxuICAgICAgICAgICAgdm90ZSxcclxuICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgcGFydHlcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS50YWJsZShyZXN1bHRzKTtcclxufVxuXG59KCkpO1xuIl19
